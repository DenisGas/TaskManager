@using TaskManager.Data.Models
@model TaskManager.Models.HomeViewModel

@{
    ViewData["Title"] = "Домашня сторінка";
}

<style>
    .text-truncate {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .line-clamp {
        display: -webkit-box;
        -webkit-line-clamp: 2; /* Количество отображаемых строк */
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
</style>

<div class="container">
    <div class="text-center">
        <h1 class="display-4">Ласкаво просимо</h1>
        <p>Час на сервері: @DateTime.Now</p>
    </div>

    @if (Model.TasksForToday.Any())
    {
        <h2>Завдання на сьогодні</h2>
        <div class="row">
            @foreach (var task in Model.TasksForToday)
            {
                <div class="col-md-4 mb-3">
                    <div class="card @GetPriorityColor(task.Priority)">
                        <div class="card-body">
                            <div class="d-flex align-items-center mb-2">
                                <input class="form-check-input me-2" type="checkbox" id="completeCheckbox_@task.Id" @(task.IsCompleted ? "checked" : "")>
                                <h5 class="card-title mb-0 me-2 text-truncate flex-grow-1">@task.Title</h5>
                            </div>
                            <p class="card-text mb-1 text-truncate">Дата: @task.DueDate.ToShortDateString()</p>
                            <p class="card-text mb-1 text-truncate">Пріоритет: @task.Priority</p>
                            <a href="@Url.Action("Details", "Tasks", new { id = task.Id })" class="btn btn-primary">Детальніше</a>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <p>Завдань на сьогодні немає.</p>
    }

    <h2>Останні 10 завдань</h2>
    <div class="row">
        @foreach (var task in Model.Last10Tasks)
        {
            <div class="col-md-4 mb-3">
                <div class="card @GetPriorityColor(task.Priority)">
                    <div class="card-body">
                        <div class="d-flex align-items-center mb-2">
                            <input class="form-check-input me-2" type="checkbox" id="completeCheckbox_@task.Id" @(task.IsCompleted ? "checked" : "")>
                            <h5 class="card-title mb-0 me-2 text-truncate flex-grow-1">@task.Title</h5>
                        </div>
                        <p class="card-text mb-1 text-truncate">Дата: @task.DueDate.ToShortDateString()</p>
                        <p class="card-text mb-1 text-truncate">Пріоритет: @task.Priority</p>
                        <a href="@Url.Action("Details", "Tasks", new { id = task.Id })" class="btn btn-primary">Детальніше</a>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

@functions {
    string GetPriorityColor(PriorityLevel priority)
    {
        switch (priority)
        {
            case PriorityLevel.High:
                return "bg-danger";
            case PriorityLevel.Medium:
                return "bg-warning";
            case PriorityLevel.Low:
                return "bg-info";
            default:
                return "bg-light";
        }
    }
}
